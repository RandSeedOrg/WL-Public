<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Randseed Keno v20 - Large Fonts</title>
    <style>
        :root {
            /* WARMER THEME */
            --bg-color: #242220; 
            --panel-color: #2f2d2b; 
            --accent-color: #ffd700;
            --col-blue: #3a86ff;
            --col-gold: #ffd700;
            --col-red:  #ff4444;
            --col-profit: #39ff14;
            --col-loss:   #ff4444;
            --text-white: #f0f0f0; 
            --nav-height: 48px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-white);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            user-select: none;
            cursor: pointer;
        }

        /* --- TOP NAV BAR --- */
        .nav-bar {
            width: 100%; height: var(--nav-height);
            background: #2f2d2b; border-bottom: 1px solid #3e3c3a;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 10px; position: sticky; top: 0; z-index: 500;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }
        .nav-left, .nav-right { display: flex; align-items: center; gap: 10px; flex: 1; }
        .nav-right { justify-content: flex-end; }
        .nav-center { flex: 2; text-align: center; font-size: 1rem; font-weight: bold; color: #eee; }
        .nav-icon {
            background: transparent; border: none; color: #aaa; font-size: 1.2rem;
            cursor: pointer; padding: 8px; display: flex; align-items: center;
            justify-content: center;
        }

        /* --- GAME HEADER (Balance) --- */
        .game-header-container {
            width: 100%; max-width: 600px; position: relative;
            margin: 10px 0 5px 0; padding: 0 10px; z-index: 400;
            display: flex; justify-content: flex-end; flex-shrink: 0;
        }
        
        .balance-dropdown-trigger {
            display: flex; align-items: center; justify-content: space-between;
            gap: 8px;
            background: var(--panel-color); padding: 8px 15px;
            border-radius: 8px; border: 1px solid #3e3c3a; cursor: pointer;
            width: 300px; max-width: 100%;
        }
        
        .bal-label { font-size: 0.8rem; color: #888; font-weight: bold; }
        .bal-amount { font-size: 1.4rem; font-weight: 800; color: var(--accent-color); letter-spacing: 0.5px; }
        .bal-arrow { font-size: 0.8rem; color: #888; transition: transform 0.3s; }
        .bal-arrow.rotate { transform: rotate(180deg); }

        .history-panel {
            position: absolute; top: 100%; right: 10px; width: 300px;
            background: #2f2d2b; border: 1px solid #3e3c3a; border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            max-height: 0; overflow: hidden; transition: all 0.2s ease-in-out;
            opacity: 0; pointer-events: none;
        }
        .history-panel.open { max-height: 350px; opacity: 1; pointer-events: auto; margin-top: 5px; }
        .hist-row { display: grid; grid-template-columns: 2fr 1fr 1fr; padding: 12px; border-bottom: 1px solid #3e3c3a; font-size: 0.9rem; color: #ccc; }
        .net-pos { color: var(--col-profit); font-weight: bold; }
        .net-neg { color: var(--col-loss); }

        /* --- MAIN LAYOUT --- */
        .game-layout {
            display: flex; flex-direction: column;
            width: 100%; max-width: 600px;
            padding: 0 10px;
        }

        /* GRID */
        .grid-container {
            background: var(--panel-color); padding: 8px; border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            margin-bottom: 8px;
        }
        .keno-grid {
            display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px;
        }
        @media (max-width: 480px) {
            .keno-grid { grid-template-columns: repeat(8, 1fr); gap: 4px; }
        }

        .ball {
            aspect-ratio: 1; background: #3a3836; border: 2px solid #4a4846; border-radius: 50%;
            color: #ccc; font-weight: 800; cursor: pointer; display: flex;
            align-items: center; justify-content: center; font-size: 18px; /* INCREASED from 13px */
            transition: transform 0.1s; position: relative;
        }
        .ball.active-pick { background: var(--col-blue) !important; color: white !important; border-color: #88ccff !important; box-shadow: 0 0 8px rgba(58, 134, 255, 0.6) !important; z-index: 100; }
        .ball.hist-gold { background: var(--col-gold); color: black; border-color: #fff; box-shadow: 0 0 8px var(--col-gold); font-weight: 900; z-index: 10; }
        .ball.hist-red { background: #3a0000; border-color: var(--col-red); color: var(--col-red); opacity: 0.9; }
        
        /* High Contrast Drawn */
        .ball.hist-drawn { 
            background: #656361; 
            color: #ffffff; 
            border-color: #aaaaaa; 
            box-shadow: inset 0 0 5px rgba(255,255,255,0.1);
            z-index: 5;
        }
        
        .ball.hist-gold.pulsing { animation: winPulse 1.5s infinite; }
        @keyframes winPulse { 0% { box-shadow: 0 0 5px var(--col-gold); } 50% { box-shadow: 0 0 15px var(--col-gold); } 100% { box-shadow: 0 0 5px var(--col-gold); } }

        /* PAYTABLE */
        .paytable-wrapper {
            background: var(--panel-color); padding: 12px 8px; border-radius: 12px;
            border: 1px solid #3e3c3a; margin-bottom: 8px;
            display: flex; flex-direction: column; justify-content: center;
            min-height: 60px;
        }
        .status-text { 
            text-align: center; color: #ffffff; font-size: 1.3rem; font-weight: bold; /* INCREASED from 0.8rem */
            margin-bottom: 8px; min-height: 1.2em; transition: color 0.2s;
        }
        .status-warn { color: #ffaa00 !important; font-weight: bold; animation: shake 0.4s; }
        @keyframes shake { 0%{transform:translateX(0)} 25%{transform:translateX(-5px)} 50%{transform:translateX(5px)} 75%{transform:translateX(-5px)} 100%{transform:translateX(0)} }

        .pay-pills-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; }
        .pay-pill {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: transparent; padding: 2px 5px; border-radius: 6px; min-width: 45px;
        }
        .pay-mult { font-size: 1rem; font-weight: bold; color: #fff; margin-bottom: 4px; } /* INCREASED */
        .pay-hit-circle {
            width: 28px; height: 28px; border-radius: 50%; /* INCREASED */
            background: #3a3836; color: #888; font-size: 1rem; font-weight: bold; /* INCREASED */
            display: flex; align-items: center; justify-content: center;
            border: 1px solid #4a4846; transition: all 0.2s;
        }
        .pay-pill.active .pay-hit-circle { background: var(--col-profit); color: #000; border-color: #fff; box-shadow: 0 0 6px var(--col-profit); transform: scale(1.1); }
        .pay-pill.active .pay-mult { color: var(--col-profit); }

        /* CONTROLS */
        .controls-wrapper {
            display: flex; flex-direction: column; gap: 8px;
            margin-top: 10px; 
            padding-bottom: 60px;
        }

        .slider-row {
            display: flex; align-items: center; justify-content: space-between;
            background: #2f2d2b; padding: 5px 15px; border-radius: 10px; border: 1px solid #3e3c3a;
            height: 50px; transition: border-color 0.2s, box-shadow 0.2s;
        }
        .slider-row.warn { border-color: #ffaa00; box-shadow: 0 0 10px rgba(255, 170, 0, 0.3); }

        .slider-label { font-size: 0.8rem; color: #888; font-weight: bold; text-transform:uppercase; letter-spacing:0.5px; margin-right: 10px; }
        input[type=range] { -webkit-appearance: none; flex: 1; background: transparent; height: 100%; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 26px; width: 26px; border-radius: 50%;
            background: var(--col-blue); cursor: pointer; margin-top: -11px;
            box-shadow: 0 0 5px rgba(58, 134, 255, 0.8); border: 2px solid white;
        }
        input[type=range].slider-off::-webkit-slider-thumb {
            background: #666; box-shadow: none; border-color: #888;
        }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #444; border-radius: 2px; }
        
        .slider-val-box {
            background:#3a3836; width:40px; height:32px; border-radius:6px; 
            display:flex; align-items:center; justify-content:center; 
            border:1px solid #4a4846; margin-left: 10px;
        }
        .slider-val-text { font-weight:bold; font-size:1.2rem; color: var(--col-blue); } /* INCREASED */
        .slider-val-off { color: #888; font-size: 0.8rem; letter-spacing: 1px; }

        .buttons-row {
            display: flex; gap: 6px; 
            align-items: stretch;
            height: 52px; 
        }
        
        button { border-radius: 10px; border:none; font-weight:bold; cursor:pointer; font-size: 1rem; position: relative; overflow: hidden; }
        button:active { transform: scale(0.96); filter: brightness(0.9); }

        .btn-bet-grp {
            display: flex; gap: 2px; background: #3a3836; border-radius: 10px; padding: 2px;
            flex-shrink: 0;
        }
        .btn-bet-act { background: #4a4846; color: white; width: 35px; border-radius: 8px; font-size: 1.2rem;}
        .btn-bet-val { background: transparent; color: #ddd; width: 60px; font-size: 0.95rem; cursor: default; } /* INCREASED */

        .btn-clear { background: #3a3836; color: white; width: 45px; flex-shrink: 0; font-size: 1.2rem; }
        
        .btn-auto {
            background: #3a3836; color: white; border: 1px solid #4a4846;
            flex: 1.2; font-size: 0.95rem; line-height: 1.1; 
        }
        .btn-auto.active { background: var(--col-blue); border-color: #88ccff; color: white; }

        .btn-play { 
            background: linear-gradient(135deg, #39ff14, #008f09); color: white; 
            flex: 1.8; font-size: 1.4rem; text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            box-shadow: 0 4px 10px rgba(57, 255, 20, 0.2); letter-spacing: 1px;
        }
        .btn-play:disabled { background: #444; cursor: not-allowed; color: #888; box-shadow:none; }

        /* Win Overlay */
        .win-overlay {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            background: rgba(40, 38, 36, 0.98); border: 2px solid var(--accent-color);
            padding: 30px; border-radius: 20px; text-align: center; z-index: 999;
            pointer-events: none; transition: transform 0.2s ease-out; width: 80%; max-width: 300px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }
        .win-overlay.show { transform: translate(-50%, -50%) scale(1); }

    </style>
</head>
<body>

    <script>
        const AudioSys = {
            ctx: null, muted: false,
            init: function() { if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); if (this.ctx.state === 'suspended') this.ctx.resume(); },
            toggleMute: function() { this.muted = !this.muted; return this.muted; },
            playTone: function(f, t, d, v=0.1) { if(this.muted) return; if(!this.ctx) this.init(); const o=this.ctx.createOscillator(),g=this.ctx.createGain(); o.type=t; o.frequency.setValueAtTime(f, this.ctx.currentTime); g.gain.setValueAtTime(v, this.ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime+d); o.connect(g); g.connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime+d); },
            click: function() { this.playTone(800,'sine',0.1,0.05); },
            toggle: function() { this.playTone(600,'triangle',0.1,0.05); },
            error: function() { this.playTone(150, 'sawtooth', 0.2, 0.1); this.playTone(100, 'sawtooth', 0.2, 0.1); },
            pop: function() { if(this.muted)return; if(!this.ctx)this.init(); const o=this.ctx.createOscillator(),g=this.ctx.createGain(); o.frequency.setValueAtTime(200,this.ctx.currentTime); o.frequency.exponentialRampToValueAtTime(600,this.ctx.currentTime+0.1); g.gain.setValueAtTime(0.1,this.ctx.currentTime); g.gain.linearRampToValueAtTime(0,this.ctx.currentTime+0.1); o.connect(g); g.connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime+0.1); },
            win: function() { if(this.muted)return; setTimeout(()=>this.playTone(523.25,'sine',0.4,0.1),0); setTimeout(()=>this.playTone(659.25,'sine',0.4,0.1),100); setTimeout(()=>this.playTone(783.99,'sine',0.8,0.1),200); },
            slide: function() { this.playTone(400,'sine',0.05,0.02); }
        };
    </script>

    <!-- TOP NAV -->
    <div class="nav-bar">
        <div class="nav-left">
            <button class="nav-icon" onclick="exitGame()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg></button>
        </div>
        <div class="nav-center">Randseed Keno</div>
        <div class="nav-right">
            <button class="nav-icon" id="btnSound" onclick="toggleMute()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg></button>
            <button class="nav-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg></button>
        </div>
    </div>

    <!-- BALANCE DROPDOWN -->
    <div class="game-header-container">
        <div class="balance-dropdown-trigger" id="balanceTrigger" onclick="toggleHistory(event)">
            <span class="bal-label">BAL</span>
            <span class="bal-amount" id="balance">$1,000.00</span>
            <span class="bal-arrow" id="balArrow">‚ñº</span>
        </div>
        <div id="historyPanel" class="history-panel"><div style="padding:15px; text-align:center; color:#555; font-size:0.8rem;">No history yet</div></div>
    </div>

    <!-- MAIN GAME AREA -->
    <div class="game-layout">
        <!-- GRID -->
        <div class="grid-container">
            <div class="keno-grid" id="grid"></div>
        </div>

        <!-- PRIZE BOX -->
        <div class="paytable-wrapper">
            <div id="statusMsg" class="status-text">Pick 1-10 Numbers</div>
            <div class="pay-pills-container" id="paytablePills"></div>
        </div>

        <!-- CONTROLS -->
        <div class="controls-wrapper">
            <!-- Slider -->
            <div class="slider-row" id="sliderRow">
                <span class="slider-label">Random</span>
                <input type="range" id="pickSlider" min="0" max="10" value="4" 
                       oninput="onSliderInput(this.value)" 
                       onchange="onSliderChange(this.value)">
                <div class="slider-val-box" id="sliderValBox">
                    <span id="pickVal" class="slider-val-text">4</span>
                </div>
            </div>

            <!-- Single Row Buttons -->
            <div class="buttons-row">
                <div class="btn-bet-grp">
                    <button class="btn-bet-act" onclick="changeBet(-1)">-</button>
                    <button class="btn-bet-val" id="betDisplay">$1.00</button>
                    <button class="btn-bet-act" onclick="changeBet(1)">+</button>
                </div>
                
                <button class="btn-clear" onclick="clearSelection()">üóëÔ∏è</button>
                
                <!-- Random Auto -->
                <button class="btn-auto" id="btnAuto" onclick="toggleAutoPlay()">Random Auto</button>
                
                <!-- PLAY -->
                <button class="btn-play" id="playBtn" onclick="manualPlay()">PLAY</button>
            </div>
        </div>
    </div>

    <!-- OVERLAY -->
    <div id="winOverlay" class="win-overlay">
        <h2 style="color:white; margin:0; text-transform:uppercase; letter-spacing:2px; font-size: 1.5rem;">You Won</h2>
        <div id="winAmountDisplay" style="font-size:4rem; color:var(--accent-color); font-weight:900; margin:10px 0;">$0.00</div>
        <div style="font-size:0.9rem; color:#888; margin-top:5px;">Tap anywhere to close</div>
    </div>

    <script>
        document.addEventListener('click', function(e) {
            const overlay = document.getElementById('winOverlay');
            if (overlay.classList.contains('show')) overlay.classList.remove('show');
            const histPanel = document.getElementById('historyPanel');
            const balTrigger = document.getElementById('balanceTrigger');
            if (histPanel.classList.contains('open') && !balTrigger.contains(e.target)) {
                histPanel.classList.remove('open');
                document.getElementById('balArrow').classList.remove('rotate');
            }
        });
        document.body.addEventListener('click', () => AudioSys.init(), { once: true });

        function exitGame() { alert("Returning to Main Page..."); }
        function toggleMute() {
            const isMuted = AudioSys.toggleMute();
            const btn = document.getElementById('btnSound');
            btn.innerHTML = isMuted ? '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>' : '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>';
            btn.style.opacity = isMuted ? "0.5" : "1";
        }

        const TOTAL_NUMBERS = 40, DRAW_SIZE = 10;
        
        // --- CUSTOM PAYTABLE CONFIGURATION ---
        const PAYTABLES = { 
            1: {1:3.5}, 
            2: {2:16}, 
            3: {2:0.5, 3:75}, 
            4: {3:8, 4:240}, 
            5: {3:3, 4:45, 5:430}, 
            6: {4:9, 5:330, 6:680}, 
            7: {4:5, 5:80, 6:380, 7:770}, 
            8: {4:3.5, 5:17, 6:250, 7:550, 8:850}, 
            9: {4:3, 5:8, 6:40, 7:450, 8:750, 9:950}, 
            10: {4:2.5, 5:6, 6:10, 7:50, 8:450, 9:750, 10:1000} 
        };
        
        let state = { 
            balance: 1000.00, 
            bet: 1.00, 
            selected: [], lastSelected: [], lastDrawn: [], 
            isPlaying: false, isAutoPlaying: false, 
            pickMode: 'random', 
            sliderValue: 4, 
            history: [] 
        };

        window.onload = function() { initGrid(); generateRandomSelection(4); updateBalance(); };

        function initGrid() {
            const gridEl = document.getElementById('grid'); gridEl.innerHTML = ''; 
            for (let i = 1; i <= TOTAL_NUMBERS; i++) {
                let btn = document.createElement('div'); btn.className = 'ball'; btn.innerText = i; btn.id = `ball-${i}`;
                btn.onclick = (e) => { e.stopPropagation(); toggleNumber(i); };
                gridEl.appendChild(btn);
            }
        }

        // SLIDER UPDATE LOGIC
        function onSliderInput(val) { 
            AudioSys.slide();
            const num = parseInt(val);
            const valSpan = document.getElementById('pickVal');
            const slider = document.getElementById('pickSlider');
            
            // Clear warning
            document.getElementById('sliderRow').classList.remove('warn');
            const statusEl = document.getElementById('statusMsg');
            if(statusEl.innerText.includes("Select Random")) statusEl.innerText = "Pick 1-10 Numbers";
            statusEl.classList.remove('status-warn');

            if (num === 0) {
                valSpan.innerText = "OFF";
                valSpan.className = "slider-val-off";
                slider.classList.add("slider-off");
            } else {
                valSpan.innerText = num;
                valSpan.className = "slider-val-text";
                slider.classList.remove("slider-off");
            }
        }

        function onSliderChange(val) { 
            AudioSys.click(); 
            if(state.isAutoPlaying) stopAutoPlay();
            
            const num = parseInt(val);
            if (num === 0) {
                state.pickMode = 'manual';
                state.selected = [];
                updateUI();
            } else {
                state.sliderValue = num; 
                state.pickMode = 'random'; 
                generateRandomSelection(state.sliderValue);
            }
        }

        function generateRandomSelection(qty) { 
            state.selected = []; 
            while(state.selected.length < qty) { 
                let r = Math.floor(Math.random() * TOTAL_NUMBERS) + 1; 
                if(!state.selected.includes(r)) state.selected.push(r); 
            } 
            updateUI(); 
        }

        function toggleHistory(e) { if(e) e.stopPropagation(); AudioSys.click(); document.getElementById('historyPanel').classList.toggle('open'); document.getElementById('balArrow').classList.toggle('rotate'); }

        function toggleNumber(num) { 
            if (state.isPlaying) return; 
            AudioSys.click(); 
            if(state.isAutoPlaying) stopAutoPlay(); 
            switchToManualMode();
            const idx = state.selected.indexOf(num); 
            if (idx > -1) state.selected.splice(idx, 1); 
            else if (state.selected.length < 10) state.selected.push(num); 
            updateUI(); 
        }

        function switchToManualMode() {
            state.pickMode = 'manual';
            const slider = document.getElementById('pickSlider');
            slider.value = 0;
            slider.classList.add("slider-off");
            const valSpan = document.getElementById('pickVal');
            valSpan.innerText = "OFF";
            valSpan.className = "slider-val-off";
        }

        function clearSelection() { 
            if (state.isPlaying) return; 
            AudioSys.click(); 
            if(state.isAutoPlaying) stopAutoPlay(); 
            state.selected = []; 
            switchToManualMode();
            updateUI(); 
        }

        function changeBet(dir) { if (state.isPlaying) return; AudioSys.click(); const a = [1, 2, 5, 10, 20]; let i = a.indexOf(state.bet); if (dir === 1 && i < a.length - 1) state.bet = a[i + 1]; if (dir === -1 && i > 0) state.bet = a[i - 1]; document.getElementById('betDisplay').innerText = `$${state.bet.toFixed(2)}`; updateUI(); }
        
        function toggleAutoPlay() { AudioSys.toggle(); if(state.isAutoPlaying) stopAutoPlay(); else startAutoPlay(); }
        
        function startAutoPlay() { 
            // STRICT CHECK: If Slider is 0, DO NOT START.
            const sliderVal = parseInt(document.getElementById('pickSlider').value);
            if (sliderVal === 0) {
                AudioSys.error();
                const statusEl = document.getElementById('statusMsg');
                statusEl.innerText = "‚ö† Select Random Amount";
                statusEl.classList.remove('status-warn'); void statusEl.offsetWidth; statusEl.classList.add('status-warn');
                const sliderRow = document.getElementById('sliderRow');
                sliderRow.classList.remove('warn'); void sliderRow.offsetWidth; sliderRow.classList.add('warn');
                return; 
            }

            if (state.balance < state.bet) return; 
            state.pickMode = 'random';
            state.sliderValue = sliderVal;
            if (state.selected.length === 0) generateRandomSelection(state.sliderValue); 
            state.isAutoPlaying = true; 
            document.getElementById('btnAuto').innerText = "Stop"; 
            document.getElementById('btnAuto').classList.add('active'); 
            playGame(); 
        }
        
        function stopAutoPlay() { 
            state.isAutoPlaying = false; 
            document.getElementById('btnAuto').innerText = "Random Auto"; 
            document.getElementById('btnAuto').classList.remove('active'); 
        }
        
        function manualPlay() { AudioSys.click(); if(state.isAutoPlaying) stopAutoPlay(); playGame(); }

        async function playGame() {
            // 1. SMART REPLAY
            if (!state.isAutoPlaying && state.pickMode === 'manual' && state.selected.length === 0 && state.lastSelected.length > 0) {
                state.selected = [...state.lastSelected];
                updateUI();
                await new Promise(r => setTimeout(r, 200));
            }
            // 2. RANDOM MODE
            else if (state.pickMode === 'random') { 
                if (state.sliderValue > 0) {
                    generateRandomSelection(state.sliderValue); 
                    await new Promise(r => setTimeout(r, 100)); 
                }
            }

            if (state.selected.length === 0 || state.balance < state.bet) { stopAutoPlay(); return; }
            document.getElementById('winOverlay').classList.remove('show');
            state.isPlaying = true; const currentBet = state.bet; state.balance -= currentBet; updateBalance();
            state.lastSelected = []; state.lastDrawn = []; updateUI();
            document.getElementById('playBtn').disabled = true; document.getElementById('statusMsg').innerText = "Drawing...";
            const drawn = []; while(drawn.length < DRAW_SIZE) { let r = Math.floor(Math.random() * TOTAL_NUMBERS) + 1; if(!drawn.includes(r)) drawn.push(r); }
            let hits = 0;
            for (let i = 0; i < DRAW_SIZE; i++) {
                await new Promise(r => setTimeout(r, 50)); const num = drawn[i]; AudioSys.pop();
                const ball = document.getElementById(`ball-${num}`);
                if (state.selected.includes(num)) { ball.classList.add('hist-gold'); hits++; } else { ball.classList.add('hist-drawn'); }
            }
            const spots = state.selected.length; const paytable = PAYTABLES[spots]; const multiplier = paytable[hits] || 0; const winAmount = currentBet * multiplier;
            const now = new Date(); const ts = `${String(now.getFullYear()).slice(-2)}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}`;
            state.history.unshift({ time: ts, hits: hits, total: spots, net: winAmount - currentBet }); renderHistoryPanel();
            if (winAmount > 0) {
                state.balance += winAmount; AudioSys.win(); showWin(winAmount);
                document.getElementById('statusMsg').innerText = `WON $${winAmount.toFixed(2)}!`;
                drawn.forEach(d => { if(state.selected.includes(d)) document.getElementById(`ball-${d}`).classList.add('pulsing'); });
            } else { document.getElementById('statusMsg').innerText = "No match"; }
            state.lastSelected = [...state.selected]; state.lastDrawn = [...drawn]; state.selected = [];
            state.isPlaying = false; document.getElementById('playBtn').disabled = false; updateBalance(); updateUI();
            if (state.isAutoPlaying) { if (state.balance >= state.bet) { setTimeout(() => { if(state.isAutoPlaying) playGame(); }, 2000); } else { stopAutoPlay(); } }
        }

        function showWin(amount) { document.getElementById('winAmountDisplay').innerText = `$${amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`; document.getElementById('winOverlay').classList.add('show'); }
        function renderHistoryPanel() { const p = document.getElementById('historyPanel'); if(state.history.length === 0) return; p.innerHTML = ''; state.history.forEach(r => { const row = document.createElement('div'); row.className = 'hist-row'; const c = r.net >= 0 ? 'net-pos' : 'net-neg'; const s = r.net >= 0 ? '+' : ''; row.innerHTML = `<div style="font-family:monospace; color:#888;">${r.time}</div><div style="text-align:center;">${r.hits}/${r.total}</div><div style="text-align:right;" class="${c}">${s}$${r.net.toFixed(2)}</div>`; p.appendChild(row); }); }
        function updateUI() {
            for (let i = 1; i <= TOTAL_NUMBERS; i++) { const b = document.getElementById(`ball-${i}`); b.className = 'ball'; if (state.selected.includes(i)) { b.classList.add('active-pick'); continue; } if (state.lastSelected.includes(i) && state.lastDrawn.includes(i)) { b.classList.add('hist-gold'); if(document.getElementById('statusMsg').innerText.includes("WON")) b.classList.add('pulsing'); continue; } if (state.lastSelected.includes(i) && !state.lastDrawn.includes(i)) { b.classList.add('hist-red'); continue; } if (state.lastDrawn.includes(i)) { b.classList.add('hist-drawn'); } }
            const pc = document.getElementById('paytablePills'); pc.innerHTML = ''; const s = state.selected.length > 0 ? state.selected.length : (state.pickMode === 'random' ? state.sliderValue : (state.lastSelected.length || 1)); const t = PAYTABLES[s]; let wh = -1; if(!state.isPlaying && state.history.length > 0 && state.history[0].total === s) wh = state.history[0].hits;
            if(t) { Object.keys(t).sort((a,b)=>a-b).forEach(h => { let m = t[h]; const p = document.createElement('div'); p.className = 'pay-pill'; if (parseInt(h) === wh) p.classList.add('active'); p.innerHTML = `<span class="pay-mult">${m}x</span><div class="pay-hit-circle">${h}</div>`; pc.appendChild(p); }); }
        }
        function updateBalance() { document.getElementById('balance').innerText = `$${state.balance.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`; }
    </script>
</body>
</html>
